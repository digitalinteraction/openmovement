<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Developer Guide - BuildAX</title>

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="./css/theme.css" type="text/css" />
  <link rel="stylesheet" href="./css/extra.css" type="text/css" />
  

  <script type="text/javascript" src="./js/theme.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>
  

  <style>
    body {font-size: 90%;}
    pre, code {font-size: 100%;}
    h3, h4, h5, h6 {color: #2980b9; font-weight: 300}
  </style>
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="index.html" class="icon icon-home"> BuildAX</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
       <ul class="current">

    <li class="toctree-l1 ">
        <a class="" href="index.html">Home</a>
        
    </li>

    <li class="toctree-l1 ">
        <a class="" href="hardware.html">Hardware</a>
        
    </li>

    <li class="toctree-l1 ">
        <a class="" href="quickstart.html">Quick Start</a>
        
    </li>

    <li class="toctree-l1 ">
        <a class="" href="deployment.html">Deployment</a>
        
    </li>

    <li class="toctree-l1 ">
        <a class="" href="connecting.html">Connection Guide</a>
        
    </li>

    <li class="toctree-l1 ">
        <a class="" href="commands-lrs.html">Commands (LRS)</a>
        
    </li>

    <li class="toctree-l1 ">
        <a class="" href="commands-env.html">Commands (ENV)</a>
        
    </li>

    <li class="toctree-l1 ">
        <a class="" href="datafiles.html">Data Files</a>
        
    </li>

    <li class="toctree-l1 ">
        <a class="" href="user-guide.html">Web Interface</a>
        
    </li>

    <li class="toctree-l1 current">
        <a class="current" href="developer-api.html">Developer Guide</a>
        
            <ul>
            
                <li class="toctree-l2"><a href="#buildax-lrs-developer-api">BuildAX LRS Developer API</a></li>
                
                    <li><a class="toctree-l3" href="#logging-in">Logging In</a></li>
                
                    <li><a class="toctree-l3" href="#changing-settings">Changing Settings</a></li>
                
                    <li><a class="toctree-l3" href="#fetching-data">Fetching Data</a></li>
                
                    <li><a class="toctree-l3" href="#example-wget-commands">Example wget commands</a></li>
                
                    <li><a class="toctree-l3" href="#generic-commands">Generic Commands</a></li>
                
            
            </ul>
        
    </li>

    <li class="toctree-l1 ">
        <a class="" href="firmware.html">Firmware</a>
        
    </li>

    <li class="toctree-l1 ">
        <a class="" href="faq.html">FAQs</a>
        
    </li>

</ul>




      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="index.html"></a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
    <li>Developer Guide</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="https://code.google.com/p/openmovement/">OpenMovement</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" id="main">
            <h1 id="buildax-lrs-developer-api">BuildAX LRS Developer API</h1>
<p>The BuildAX LRS can be programatically configured via a remote connection. API calls to the BuildAX LRS are made as RESTful HTTP requests. For you, 
this means that setting state on the LRS is performed via <code>POST</code> requests, 
and <code>GET</code> requests are used to retrieve data.</p>
<p>The examples in this document use the <code>wget</code> command to communicate with the 
web server on the BuildAX LRS. On Linux <code>wget</code> is usually installed by default,
but can be downloaded for other OSes (including MacOSX and Windows) from the 
<a href="https://www.gnu.org/software/wget/">GNU website</a>.</p>
<p>An equivalent software with much the same functionality as wget is <code>curl</code>, 
which may be used in preference to <code>wget</code>.</p>
<h2 id="logging-in">Logging In</h2>
<p>The Web API uses a unique session key (a <em>cookie</em>) to authenticate users. All 
API sessions start when this session key is requested by making a POST request
to the BuildAX LRS.</p>
<p>The user agent must first authenticate with the LRS and obtain a session
cookie before further REST API requests can be made:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Resource</th>
<th>Parameters</th>
<th>Response</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>POST</code></td>
<td>/WWW/login.htm</td>
<td>user, pass</td>
<td>303 redirect with SID= session cookie.</td>
</tr>
</tbody>
</table>
<p>Example <code>wget</code> command (a backslash is used to separate the command onto 
multiple lines):</p>
<pre class="prettyprint well"><code>    wget --save-cookies cookies.txt \
        --delete-after \
        --no-http-keep-alive \
        --post-data 'user=admin&amp;pass=password' \
        --keep-session-cookies \
        http://your-bax/WWW/login.htm
</code></pre>

<p>Equivalent <code>curl</code> command:</p>
<pre class="prettyprint well"><code>    curl --silent --output /dev/null \
        -c cookies.txt \
        --data 'user=admin&amp;pass=password' \
        http://your-bax/WWW/login.htm
</code></pre>

<h2 id="changing-settings">Changing Settings</h2>
<p>Settings are passed to the server in the same format as the text command mode.
Please refer to the <a href="commands-lrs.html#settings">LRS commands</a> for a full description
of the settings commands which may be sent to the LRS. </p>
<p>Settings can be concatenated with an ampersand (&amp;) in the POST body to change 
multiple settings simultaneously. </p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Resource</th>
<th>Parameters</th>
<th>Response</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>POST</code></td>
<td>/WWW/a_settng.htm</td>
<td>Setting arguments in the format specified above</td>
<td><code>200 OK</code> Set-Cookie: update=ok</td>
</tr>
</tbody>
</table>
<pre class="prettyprint well"><code>wget --load-cookies cookies.txt \
    --post-data 'setting.usb.stream=0' \
    http://your-bax/WWW/a\_settng.htm
</code></pre>
<p>Valid settings types are: <code>file</code>, <code>usb</code>, <code>telnet</code>, and <code>udp</code>.</p>
<h2 id="fetching-data">Fetching Data</h2>
<p>Data fetching is performed via GET request, so parameters are passed in the
URL.</p>
<pre class="prettyprint well"><code>http://your-bax/fetch?type=BT&amp;start=449622000&amp;end=485434800
</code></pre>
<p>There are three parameters in a fetch request: a type, and the start/end range
specifiers.</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Resource</th>
<th>Valid Parameters</th>
<th>Response</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>GET</code></td>
<td><code>/fetch</code></td>
<td>type, start, end</td>
<td><code>200 OK</code> (and download)</td>
</tr>
</tbody>
</table>
<h3 id="fetch-types">Fetch Types</h3>
<p>The <strong>type</strong> parameter may be specified as one of the following:</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Fetch mode</th>
</tr>
</thead>
<tbody>
<tr>
<td>BT</td>
<td>Binary / Time range fetch</td>
</tr>
<tr>
<td>TT</td>
<td>Text / Time</td>
</tr>
<tr>
<td>BF</td>
<td>Binary / File</td>
</tr>
<tr>
<td>TF</td>
<td>Text / File</td>
</tr>
<tr>
<td>BS</td>
<td>Binary / Sample range <em>(note: text/sample range is not implemented)</em></td>
</tr>
<tr>
<td>LS</td>
<td>Last N Samples <em>(note: specify an empty 'end' parameter with this request)</em></td>
</tr>
</tbody>
</table>
<h3 id="fetch-parameters">Fetch Parameters</h3>
<p>The parameters <strong>start</strong> and <strong>end</strong> are always present, but their value
changes based on the type of request.</p>
<table>
<thead>
<tr>
<th>Fetch Type</th>
<th>Range specifiers</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Time Range</strong></td>
<td>Start and end are specified in <em>seconds after the epoch 2000-01-01</em> matching the RTC timestamp</td>
</tr>
<tr>
<td><strong>File Range</strong></td>
<td>Start and end are data file numbers as stored on the external flash card storage</td>
</tr>
<tr>
<td><strong>Sample Range</strong></td>
<td>Start and end are a range of packets numbers received from the sensors</td>
</tr>
<tr>
<td><strong>Last N Samples</strong></td>
<td>Start is the number of most recent samples. Specify end as an empty string.</td>
</tr>
</tbody>
</table>
<h3 id="time-format">Time Format</h3>
<p>To calculate the time range, take the Unix timestamp for the time required (a
standard time representation) and subtract the Unix timestamp for the date
<code>2000-01-01</code>. Eg:</p>
<pre class="prettyprint well"><code>    Current Unix Time â€“ (2000-01-01 00:00) = BuildAX RTC Timestamp
           1407940334 â€“      946684800     = 461255534
</code></pre>

<p>The reason for this difference is that the hardware real-time-clock (RTC) on
the BuildAX LRS works with an epoch of the year 2000 and a 32-bit timestamp,
meaning dates up to 2068 can be represented internally.</p>
<h2 id="example-wget-commands">Example <code>wget</code> commands</h2>
<p><span class="alert alert-info"> 
<strong>Login:</strong>
Remember that you must first run the <a href="#logging-in">Login</a> command to get a
session cookie!
</span></p>
<p>Get data file 0 from the SD card (no more than 5 files (10MB) may be requested in one download):</p>
<pre class="prettyprint well"><code>wget --load-cookies cookies.txt \
    --no-http-keep-alive \
    --content-disposition \
    http://your-bax/fetch?type=BF\&amp;start=0\&amp;end=0
</code></pre>
<p>Get last 500 samples:</p>
<pre class="prettyprint well"><code>wget --load-cookies cookies.txt \
    --no-http-keep-alive \
    --content-disposition \
    http://your-bax/fetch?type=LS&amp;start=500&amp;end=
</code></pre>
<p>Get data within a time range:</p>
<pre class="prettyprint well"><code>wget --load-cookies cookies.txt \
    --no-http-keep-alive \
    --content-disposition \
    http://your-bax/fetch?type=BT\&amp;start=449622000\&amp;end=485434800
</code></pre>
<p>One possible 'gotcha' is that the ampersand (&amp;) symbol has a special meaning
in most command terminals, and must be escaped with a backslash (as in the 
above examples) so that the command is not forked.</p>
<h2 id="generic-commands">Generic Commands</h2>
<p>In addition to the commands listed above, some commands listed in the 
<a href="#commands-lrs">LRS Commands</a> section can be sent using this interface.</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Resource</th>
<th>Valid Parameters</th>
<th>Response</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>POST</code></td>
<td><code>/cmd</code></td>
<td>LRS command</td>
<td><code>200 OK</code> (even if the command failed)</td>
</tr>
</tbody>
</table>
<p>A specific limitation of this HTTP interface is that it is not currently
possible to include feedback from this command in the HTTP response. The
server will return the response code, along with an empty response body. This
means that commands (e.g. <code>status</code>) which are only useful for their response
will not be useful to call through this interface. Commands which perform 
some action (e.g. <code>save</code>) are the use case for this feature.</p>
<p>Example:</p>
<pre class="prettyprint well"><code>http://your-bax/cmd?save
</code></pre>
<p>Additionally, HTTP special characters will not be parsed correctly until 
firmware v1.4. This will make it possible to set the RTC time via the REST
interface.</p>

          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="firmware.html" class="btn btn-neutral float-right" title="Firmware"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="user-guide.html" class="btn btn-neutral" title="Web Interface"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
      Developed at <a href="http://di.ncl.ac.uk/blog/open-movement/" rel="nofollow">Newcastle University, UK</a>.
      Available under <a href="http://creativecommons.org/licenses/by/3.0/" rel="nofollow">CC 3.0 BY Attribution</a> License
    </p>
  </div>

  <p>
    Docs built with <a href="http://www.mkdocs.org">MkDocs</a> &bull; Theme based on <a href="https://github.com/snide/sphinx_rtd_theme">Read the Docs</a> 
  </p>
</footer>
        </div>
      </div>

    </section>

  </div>
<!--
<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span><a href="" style="color: #fcfcfc;">&laquo; Previous</a></span>
      <span style="margin-left: 15px"><a href="" style="color: #fcfcfc">Next &raquo;</a></span>
    </span>
</div>
-->
</body>
</html>